<div class="col-11 padding0">

		<%= form_tag(books_path, method: "get" ) do %>
			<input  id="search" type="text" class="form-control search-form" name="search" placeholder="What are you reading next?">
  		<%= submit_tag 'Search', class:"btn btn-primary", type:"submit"%>
		<% end %>
		<div id="search-results" class="column d-flex">
		</div>


		<h2>Reviews </h2>

		<select name="sample" onchange="location = this.value;">
			<option value="">---Sort by---</option>
			<option value="<%= "#{reviews_path}?sort=rating" %>">Highest rated</option>
			<option value="<%= "#{reviews_path}?sort=desc" %>">Most recent</option>
			<option value="<%= "#{reviews_path}?sort=own" %>">My reviews</option>
		</select>

		<br>
		<br>

	  <%= link_to 'Add a new review', new_review_path %>

	  <br>
	  <br>

	  <% @reviews.each.with_index do |review, index| %>

	   	<div class="row">

		   	<div class="col-3 d-flex justify-content-center">
		   		<img height="200px" src=<%= review.book.image_url %>
		   	</div>
		   </div>

		  <div class="col-7">



	   		<%= link_to "#{review.book.title}", book_path(review.book_id) %>
	   		<br>
	   		<%= review.book.author %>

	   		<br><br>

	   		<!-- If bookstatuses for this book exists  -->
		  	<% if review.book.bookstatuses.first %>

		  	<!-- Loop through records and get the read_status for the current user -->
		   		<% review.book.bookstatuses.map do |meep| %>
		   			<% if meep.user_id == current_user.id %>

		   				<!-- Recording read status... -->
		   				<% @p_read_status = meep.read_status %>

		   			<% else %>
		   			<% end %>

		   			<% end %>

		   	<% else %>

		   	<!-- If there are no records at all (this means that this specific book has not been marked with ANY status at all by any users) -->
		   	<!-- Set p_read_status; and do nothing -->
		   		<% @p_read_status = -1 %>

		   	<% end %>






	   		<%= review.user.username %> rated it
				<% if review.rating == 5 %>

	   			<span class="star-color">★★★★★</span>
	   		<% elsif review.rating == 4 %>
	   			<span class="star-color">★★★★</span><span class="star-color-2">★</span>
	   		<% elsif review.rating == 3 %>
	   			<span class="star-color">★★★</span><span class="star-color-2">★★</span>
	   		<% elsif review.rating == 2 %>
	   			<span class="star-color">★★</span><span class="star-color-2">★★★</span>
	   		<% else %>
	   			<span class="star-color">★</span><span class="star-color-2">★★★★</span>
	   		<% end %>

		   	<br>

	   		<div class="review-content-">
					<%= review.reviews %>
				</div>

				<br>

					<span class="star-color-2"><%= review.created_at.in_time_zone('Singapore').strftime('%d %B %Y %I:%M %p') %></span>

					<!-- Only show edit and delete functions to current logged in user, with Devise -->

					<% if current_user == review.user %>

					<!-- looping through with index. so that each form has a unique Id to it -->
					<!-- refer to reviews.js & hidden_edit.html.erb for more-->
					<% indexNow = index+1 %>
					<% idUnqiue = 'review_' + indexNow.to_s %>

	  				<div class="row ml-1">
	  					<!-- #edit button , pressing this will render hidden_edit.html form-->
							<div class="edit-review" id=<%= idUnqiue %>>✏️</div>

							<%= link_to '❌',review_path(review), method: :delete, data: { confirm: 'Do you really want to delete this?'} %>

						</div>
						<% indexNow = index+1 %>
						<!-- renders edit form when button pressed -->
						<%= render partial: 'reviews/hidden_edit' , locals: {object: review, indexNum: indexNow } %>
					<% else %>
					<% end %>
					<%= render partial: 'bookstatuses/readstatus' , locals: { object: review.book }  %>
					<!-- Sending information to dropdown partial: Book, booklists, read status -->
				<%= render partial: 'booklists/dropdown', locals: { object: review.book, list: @booklists, readstatus: @p_read_status } %>
				</div>

		  </div>
		  <hr>
		  <% end %>

	</div>
</div>

<script src="/assets/search-bar.js" type="text/javascript"></script>
<script src="/assets/reviews.js" type="text/javascript"></script>